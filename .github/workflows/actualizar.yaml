name: Actualizar Precios Eneba Xbox

# ACTIVADORES
on:
  schedule:
    # Se ejecuta automáticamente cada 6 horas (ej: 00:00, 06:00, 12:00, 18:00 UTC)
    - cron: '0 */6 * * *'
  
  # Permite ejecutarlo manualmente desde la pestaña "Actions" de GitHub
  workflow_dispatch:

# PERMISOS
permissions:
  contents: write  # CRUCIAL: Necesita permiso para guardar el nuevo catalogo.json

jobs:
  build:
    runs-on: ubuntu-latest # El servidor que corre el bot

    steps:
      # 1. Descarga el código de tu repositorio
      - name: Checkout repositorio
        uses: actions/checkout@v3

      # 2. Prepara el entorno Python
      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Instala las librerías necesarias
      - name: Instalar dependencias
        run: |
          pip install selenium webdriver-manager

      # 4. Ejecuta el Bot (genera el nuevo catalogo.json)
      - name: Ejecutar Scraper
        run: python bot.py

      # 5. Guarda y sube los cambios a GitHub
      - name: Commit y Push de cambios
        run: |
          # Configura la identidad del bot
          git config --global user.name 'Bot Actualizador'
          git config --global user.email 'bot@noreply.github.com'
          # Añade el archivo que cambió
          git add catalogo.json
          # Verifica si hubo cambios y, si los hay, hace el commit y el push
          git diff --quiet && git diff --staged --quiet || (git commit -m "Actualización automática de precios Xbox $(date)" && git push)